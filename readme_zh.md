
# å¤©å·¥é€ æ–‡ (SkyCraft Novel AI) - ä¼ä¸šçº§å‰åç«¯åˆ†ç¦»ç‰ˆ (v2.4 Admin Pro)

> **æ¶æ„ç†å¿µ**: å“åº”é€Ÿåº¦ä¼˜å…ˆ (SQLite WAL + Hono + Streaming) | ç¨³å®šæ€§ä¼˜å…ˆ (Server Logger + Robust Error Handling) | è§£è€¦ä¼˜å…ˆ (Modular Router)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ AI çˆ†æ¬¾ç½‘æ–‡ç”Ÿæˆç³»ç»Ÿï¼Œå·²ä»åŸå‹å‡çº§ä¸ºå¯éƒ¨ç½²çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå¹¶æ”¯æŒå¤šç”¨æˆ·ç™»å½•ã€äº‘ç«¯å­˜æ¡£å’Œå…¨é“¾è·¯ç›‘æ§ã€‚

**v2.4 æ›´æ–°ï¼šåå°ç®¡ç†ç³»ç»Ÿå¤§å¹…å¢å¼ºï¼Œæ–°å¢ç”¨æˆ·CRUDåŠŸèƒ½ä¸å¯è§†åŒ– API å®éªŒå®¤ã€‚**

---

## ğŸ“š ç›®å½• (Table of Contents)

1. [æŠ€æœ¯æ¶æ„è§£æ](#-æŠ€æœ¯æ¶æ„è§£æ)
2. [æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å— (Server)](#-æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å—-server)
3. [åå°ç®¡ç†ç³»ç»Ÿ (Admin Dashboard)](#-åå°ç®¡ç†ç³»ç»Ÿ-admin-dashboard)
4. [æ—¥å¿—ä¸ç›‘æ§ (Logging & Monitoring)](#-æ—¥å¿—ä¸ç›‘æ§-logging--monitoring)
5. [å‰ç«¯éƒ¨ç½²æ‰‹å†Œ (Client)](#-å‰ç«¯éƒ¨ç½²æ‰‹å†Œ-client)
6. [ä½¿ç”¨è¯´æ˜ä¹¦ (User Manual)](#-ä½¿ç”¨è¯´æ˜ä¹¦-user-manual)

---

## ğŸ›  æŠ€æœ¯æ¶æ„è§£æ

ä¸ºäº†å®ç°æè‡´çš„å“åº”é€Ÿåº¦å’Œæ‰©å±•æ€§ï¼Œæˆ‘ä»¬é€‰ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ ˆï¼š

### 1. æœåŠ¡ç«¯ (Backend) - `server/`
*   **æ ¸å¿ƒæ¡†æ¶**: **Hono**ã€‚æé€Ÿ Web æ ‡å‡†æ¡†æ¶ï¼ŒTTFB (é¦–å­—èŠ‚æ—¶é—´) æä½ã€‚
*   **è·¯ç”±è§£è€¦**: ä½¿ç”¨ `adminRouter` (`server/admin_router.ts`) ç‹¬ç«‹ç®¡ç†åå°é€»è¾‘ï¼Œä¸å½±å“ä¸»ä¸šåŠ¡ã€‚
*   **æ•°æ®åº“**: **SQLite (better-sqlite3)**ã€‚åŸºäº C++ çš„é«˜æ€§èƒ½è¿›ç¨‹å†…æ•°æ®åº“ï¼Œå¼€å¯ **WAL æ¨¡å¼** åï¼Œå¹¶å‘è¯»å†™æ€§èƒ½æä½³ã€‚
*   **æ—¥å¿—ç³»ç»Ÿ**: è‡ªç ”å†…å­˜ç¯å½¢ç¼“å†²æ—¥å¿— (`server/logger.ts`)ã€‚æ”¯æŒæ§åˆ¶å°å½©è‰²è¾“å‡º + åå°ç•Œé¢å®æ—¶æœç´¢/ç­›é€‰ã€‚
*   **é‰´æƒ**: **JWT**ã€‚æ— çŠ¶æ€è®¤è¯ï¼ŒæœåŠ¡ç«¯æ— éœ€æŸ¥æ‰¾ Sessionã€‚
*   **ç®¡ç†åå°**: **SSR + Alpine.js**ã€‚æœåŠ¡ç«¯ç›´æ¥è¿”å› HTML é¡µé¢ï¼Œé…åˆ Alpine.js å®ç°å¤æ‚çš„å‰ç«¯äº¤äº’ï¼ˆå¦‚ API æµ‹è¯•ã€å¼¹çª—ï¼‰ï¼Œæ— éœ€ç¼–è¯‘æ­¥éª¤ã€‚

### 2. å®¢æˆ·ç«¯ (Frontend) - æ ¹ç›®å½•
*   **UI æ¡†æ¶**: React 18 + Tailwind CSSã€‚
*   **çŠ¶æ€ç®¡ç†**: æœ¬åœ°ä¹è§‚æ›´æ–°ç­–ç•¥ï¼Œæ“ä½œé¡ºæ»‘æ— å¡é¡¿ã€‚

---

## ğŸ–¥ æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å— (Server)

### 1. æœåŠ¡å™¨ç›®å½•ç»“æ„

è¯·åœ¨è¿œç¨‹æœåŠ¡å™¨åˆ›å»ºæ–‡ä»¶å¤¹ `skycraft-server`ï¼š

```
skycraft-server/
â”œâ”€â”€ package.json       (å¿…é¡»)
â”œâ”€â”€ skycraft.db        (è‡ªåŠ¨ç”Ÿæˆ) SQLite æ•°æ®åº“æ–‡ä»¶
â””â”€â”€ server/            (ä»£ç ç›®å½•)
    â”œâ”€â”€ index.ts       (å…¥å£)
    â”œâ”€â”€ admin_router.ts(åå°è·¯ç”±-å¢å¼º)
    â”œâ”€â”€ db.ts          (æ•°æ®åº“å±‚-å¢å¼º)
    â”œâ”€â”€ data.ts        (ç´ ææ± )
    â”œâ”€â”€ logger.ts      (æ—¥å¿—ç³»ç»Ÿ)
    â”œâ”€â”€ prompts.ts     (æç¤ºè¯)
    â”œâ”€â”€ admin_ui.ts    (åå°æ¨¡æ¿-å¢å¼º)
    â””â”€â”€ types.ts       (ç±»å‹å®šä¹‰)
```

### 2. éƒ¨ç½²æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¯å¢ƒ
æœåŠ¡å™¨éœ€å®‰è£… Node.js (v18+) å’Œ Python/Build Toolsã€‚

#### ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–ä¸å®‰è£…
åœ¨ `skycraft-server` ç›®å½•ä¸‹ï¼š

```bash
npm init -y
npm install hono @hono/node-server @google/genai better-sqlite3 dotenv tsx
npm install --save-dev @types/better-sqlite3 @types/node
```

#### ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®ç¯å¢ƒå˜é‡
```bash
export API_KEY="your_google_api_key_here"
export JWT_SECRET="your_secure_random_string" 
export PORT=3000
export ADMIN_PASSWORD="your_admin_password" # åå°å¯†ç 
```

#### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡
```bash
npx tsx server/index.ts
```

---

## ğŸ›¡ åå°ç®¡ç†ç³»ç»Ÿ (Admin Dashboard)

è®¿é—®åœ°å€: `http://ä½ çš„æœåŠ¡å™¨IP:3000/admin`

**ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š**

1.  **Dashboard (æ¦‚è§ˆ)**
    *   å®æ—¶ç›‘æ§æ³¨å†Œç”¨æˆ·æ€»æ•°ã€‚
    *   æŸ¥çœ‹ç´¯è®¡ç”Ÿæˆçš„å­˜æ¡£æ•°é‡ã€‚
    *   æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€ï¼ˆDBæ¨¡å¼ã€APIå¥åº·åº¦ï¼‰ã€‚

2.  **Users (ç”¨æˆ·ç®¡ç†) - [NEW]**
    *   **ç”¨æˆ·åˆ—è¡¨**: æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œç”¨æˆ·ã€‚
    *   **æ–°å¢ç”¨æˆ·**: ç®¡ç†å‘˜å¯æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•è´¦å·ã€‚
    *   **é‡ç½®å¯†ç **: å¿˜è®°å¯†ç æ—¶ï¼Œç®¡ç†å‘˜å¯ç›´æ¥é‡ç½®æŒ‡å®šç”¨æˆ·çš„å¯†ç ã€‚
    *   **è¿è§„å¤„ç†**: çº§è”åˆ é™¤ç”¨æˆ·åŠå…¶æ‰€æœ‰å­˜æ¡£æ•°æ®ã€‚

3.  **Logs (ç³»ç»Ÿæ—¥å¿—)**
    *   **å®æ—¶æµ**: æ”¯æŒè‡ªåŠ¨è½®è¯¢ã€‚
    *   **é«˜çº§ç­›é€‰**: æ”¯æŒæŒ‰æ—¥å¿—çº§åˆ« (INFO/WARN/ERROR) å’Œå…³é”®è¯ç­›é€‰ã€‚
    *   **å †æ ˆè¿½è¸ª**: å‘ç”Ÿ Error æ—¶ï¼Œæ”¯æŒå±•å¼€æŸ¥çœ‹ Stack Traceã€‚

4.  **API Lab (å®éªŒå®¤) - [NEW]**
    *   **å¯è§†åŒ–æµ‹è¯•**: å†…ç½®ç±»ä¼¼ Postman çš„è°ƒè¯•ç•Œé¢ã€‚
    *   **æ¨¡æ¿é¢„è®¾**: ä¸€é”®å¡«å……ç™»å½•ã€ç”Ÿæˆã€é…ç½®æ± ç­‰æ¥å£çš„è¯·æ±‚ä½“ã€‚
    *   **æ€§èƒ½åˆ†æ**: æ˜¾ç¤ºè¯·æ±‚è€—æ—¶ (Time) å’ŒçŠ¶æ€ç ã€‚
    *   **æˆæœ¬ä¼°ç®—**: è‡ªåŠ¨ä¼°ç®— Token æ¶ˆè€—é‡ï¼ˆåŸºäºå­—ç¬¦æ•°æŠ˜ç®—ï¼‰ã€‚
    *   **é‰´æƒæ³¨å…¥**: ä¸€é”®å°† Admin Token æ³¨å…¥è¯·æ±‚å¤´ï¼Œæ–¹ä¾¿æµ‹è¯•å—ä¿æŠ¤æ¥å£ã€‚

---

## ğŸ“Š æ—¥å¿—ä¸ç›‘æ§ (Logging & Monitoring)

æˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—è½»é‡ä½†å¼ºå¤§çš„æ—¥å¿—ç³»ç»Ÿï¼Œä½äº `server/logger.ts`ã€‚

### å¼€å‘è€…æ’æŸ¥æŒ‡å—
1.  **æ§åˆ¶å°è¾“å‡º**: 
    *   æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæ‰“å° `METHOD URL - STATUS (TIMEms)`ã€‚
    *   ERROR çº§åˆ«ä¼šçº¢è‰²é«˜äº®ã€‚
2.  **å…¨å±€é”™è¯¯æ•è·**: 
    *   `server/index.ts` ä¸­é…ç½®äº†å…¨å±€ `onError` é’©å­ã€‚
    *   JWT é‰´æƒå¤±è´¥ä¼šè¿”å› 401 è€Œä¸æ˜¯ 500ã€‚
    *   æœªæ•è·å¼‚å¸¸ä¼šè®°å½•å®Œæ•´å †æ ˆå¹¶åœ¨åå° Logs é¢æ¿æ˜¾ç¤ºã€‚

---

## ğŸ“– ä½¿ç”¨è¯´æ˜ä¹¦ (User Manual)

### 1. æ³¨å†Œä¸ç™»å½•
è®¿é—®é¦–é¡µï¼Œç³»ç»Ÿä¼šå¼¹å‡ºç™»å½•æ¡†ã€‚é¦–æ¬¡ä½¿ç”¨è¯·ç›´æ¥è¾“å…¥ç”¨æˆ·åå¯†ç ç‚¹å‡» **"æ³¨å†Œè´¦å·"**ã€‚

### 2. å­˜æ¡£ç®¡ç†
*   **æ–°å»º**: ç‚¹å‡»å·¦ä¾§è¾¹æ çš„ "+ æ–°å»º"ã€‚
*   **ä¿å­˜**: ä¿®æ”¹æ ‡é¢˜åç‚¹å‡» "ä¿å­˜" æŒ‰é’®ï¼Œæˆ–æ¯æ¬¡ AI ç”Ÿæˆå®Œæˆåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æœ€æ–°è¿›åº¦ã€‚

### 3. AI åˆ›ä½œ
æµç¨‹ä¸ä¹‹å‰ä¸€è‡´ï¼šåˆ›æ„ -> å¤§çº² -> äººè®¾ -> æ­£æ–‡ã€‚

---

## ğŸ“ ç‰ˆæœ¬å†å² (Changelog)

**v2.4.1 (Hotfix)**
*   ä¿®å¤äº†æ–°å»ºå­˜æ¡£åï¼Œå·¦ä¾§åˆ—è¡¨å‡ºç°ç©ºç™½è¡Œçš„é—®é¢˜ã€‚
*   ä¿®å¤äº†ç‚¹å‡»æ–°å­˜æ¡£å¯¼è‡´é¡µé¢æŠ¥é”™ (undefined reading 'length') çš„ Bugã€‚

*Powered by Google Gemini & Hono & SQLite*
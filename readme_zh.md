
# å¤©å·¥é€ æ–‡ (SkyCraft Novel AI) - ä¼ä¸šçº§å‰åŽç«¯åˆ†ç¦»ç‰ˆ (v2.3 Admin & Logging)

> **æž¶æž„ç†å¿µ**: å“åº”é€Ÿåº¦ä¼˜å…ˆ (SQLite WAL + Hono + Streaming) | ç¨³å®šæ€§ä¼˜å…ˆ (Server Logger + Robust Error Handling) | è§£è€¦ä¼˜å…ˆ (Modular Router)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ AI çˆ†æ¬¾ç½‘æ–‡ç”Ÿæˆç³»ç»Ÿï¼Œå·²ä»ŽåŽŸåž‹å‡çº§ä¸ºå¯éƒ¨ç½²çš„å‰åŽç«¯åˆ†ç¦»æž¶æž„ï¼Œå¹¶æ”¯æŒå¤šç”¨æˆ·ç™»å½•ã€äº‘ç«¯å­˜æ¡£å’Œå…¨é“¾è·¯ç›‘æŽ§ã€‚

**v2.3 æ›´æ–°ï¼šé‡æž„åŽå°è·¯ç”± (`server/admin_router.ts`)ï¼Œå¢žå¼ºæ—¥å¿—ç­›é€‰ä¸Žå…¨å±€é”™è¯¯å¤„ç†ã€‚**

---

## ðŸ“š ç›®å½• (Table of Contents)

1. [æŠ€æœ¯æž¶æž„è§£æž](#-æŠ€æœ¯æž¶æž„è§£æž)
2. [æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å— (Server)](#-æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å—-server)
3. [åŽå°ç®¡ç†ç³»ç»Ÿ (Admin Dashboard)](#-åŽå°ç®¡ç†ç³»ç»Ÿ-admin-dashboard)
4. [æ—¥å¿—ä¸Žç›‘æŽ§ (Logging & Monitoring)](#-æ—¥å¿—ä¸Žç›‘æŽ§-logging--monitoring)
5. [å‰ç«¯éƒ¨ç½²æ‰‹å†Œ (Client)](#-å‰ç«¯éƒ¨ç½²æ‰‹å†Œ-client)
6. [ä½¿ç”¨è¯´æ˜Žä¹¦ (User Manual)](#-ä½¿ç”¨è¯´æ˜Žä¹¦-user-manual)

---

## ðŸ›  æŠ€æœ¯æž¶æž„è§£æž

ä¸ºäº†å®žçŽ°æžè‡´çš„å“åº”é€Ÿåº¦å’Œæ‰©å±•æ€§ï¼Œæˆ‘ä»¬é€‰ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ ˆï¼š

### 1. æœåŠ¡ç«¯ (Backend) - `server/`
*   **æ ¸å¿ƒæ¡†æž¶**: **Hono**ã€‚æžé€Ÿ Web æ ‡å‡†æ¡†æž¶ï¼ŒTTFB (é¦–å­—èŠ‚æ—¶é—´) æžä½Žã€‚
*   **è·¯ç”±è§£è€¦**: ä½¿ç”¨ `adminRouter` (`server/admin_router.ts`) ç‹¬ç«‹ç®¡ç†åŽå°é€»è¾‘ï¼Œä¸å½±å“ä¸»ä¸šåŠ¡ã€‚
*   **æ•°æ®åº“**: **SQLite (better-sqlite3)**ã€‚åŸºäºŽ C++ çš„é«˜æ€§èƒ½è¿›ç¨‹å†…æ•°æ®åº“ï¼Œå¼€å¯ **WAL æ¨¡å¼** åŽï¼Œå¹¶å‘è¯»å†™æ€§èƒ½æžä½³ã€‚
*   **æ—¥å¿—ç³»ç»Ÿ**: è‡ªç ”å†…å­˜çŽ¯å½¢ç¼“å†²æ—¥å¿— (`server/logger.ts`)ã€‚æ”¯æŒæŽ§åˆ¶å°å½©è‰²è¾“å‡º + åŽå°ç•Œé¢å®žæ—¶æœç´¢/ç­›é€‰ã€‚
*   **é‰´æƒ**: **JWT**ã€‚æ— çŠ¶æ€è®¤è¯ï¼ŒæœåŠ¡ç«¯æ— éœ€æŸ¥æ‰¾ Sessionã€‚
*   **ç®¡ç†åŽå°**: **SSR + Alpine.js**ã€‚æœåŠ¡å™¨ç›´æŽ¥è¿”å›ž HTML é¡µé¢ï¼Œé›¶æž„å»ºæˆæœ¬ã€‚

### 2. å®¢æˆ·ç«¯ (Frontend) - æ ¹ç›®å½•
*   **UI æ¡†æž¶**: React 18 + Tailwind CSSã€‚
*   **çŠ¶æ€ç®¡ç†**: æœ¬åœ°ä¹è§‚æ›´æ–°ç­–ç•¥ï¼Œæ“ä½œé¡ºæ»‘æ— å¡é¡¿ã€‚

---

## ðŸ–¥ æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å— (Server)

### 1. æœåŠ¡å™¨ç›®å½•ç»“æž„

è¯·åœ¨è¿œç¨‹æœåŠ¡å™¨åˆ›å»ºæ–‡ä»¶å¤¹ `skycraft-server`ï¼š

```
skycraft-server/
â”œâ”€â”€ package.json       (å¿…é¡»)
â”œâ”€â”€ skycraft.db        (è‡ªåŠ¨ç”Ÿæˆ) SQLite æ•°æ®åº“æ–‡ä»¶
â””â”€â”€ server/            (ä»£ç ç›®å½•)
    â”œâ”€â”€ index.ts       (å…¥å£)
    â”œâ”€â”€ admin_router.ts(åŽå°è·¯ç”±-æ–°å¢ž)
    â”œâ”€â”€ db.ts          (æ•°æ®åº“å±‚)
    â”œâ”€â”€ data.ts        (ç´ ææ± )
    â”œâ”€â”€ logger.ts      (æ—¥å¿—ç³»ç»Ÿ)
    â”œâ”€â”€ prompts.ts     (æç¤ºè¯)
    â”œâ”€â”€ admin_ui.ts    (åŽå°æ¨¡æ¿)
    â””â”€â”€ types.ts       (ç±»åž‹å®šä¹‰)
```

### 2. éƒ¨ç½²æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šå®‰è£…çŽ¯å¢ƒ
æœåŠ¡å™¨éœ€å®‰è£… Node.js (v18+) å’Œ Python/Build Toolsã€‚

#### ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–ä¸Žå®‰è£…
åœ¨ `skycraft-server` ç›®å½•ä¸‹ï¼š

```bash
npm init -y
npm install hono @hono/node-server @google/genai better-sqlite3 dotenv tsx
npm install --save-dev @types/better-sqlite3 @types/node
```

#### ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®çŽ¯å¢ƒå˜é‡
```bash
export API_KEY="your_google_api_key_here"
export JWT_SECRET="your_secure_random_string" 
export PORT=3000
export ADMIN_PASSWORD="your_admin_password" # åŽå°å¯†ç 
```

#### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡
```bash
npx tsx server/index.ts
```

---

## ðŸ›¡ åŽå°ç®¡ç†ç³»ç»Ÿ (Admin Dashboard)

è®¿é—®åœ°å€: `http://ä½ çš„æœåŠ¡å™¨IP:3000/admin`

**ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š**

1.  **Dashboard (æ¦‚è§ˆ)**
    *   å®žæ—¶ç›‘æŽ§æ³¨å†Œç”¨æˆ·æ€»æ•°ã€‚
    *   æŸ¥çœ‹ç´¯è®¡ç”Ÿæˆçš„å­˜æ¡£æ•°é‡ã€‚
    *   ç³»ç»Ÿæœ€åŽæ´»è·ƒæ—¶é—´ï¼ˆç”¨äºŽåˆ¤æ–­æ˜¯å¦æœ‰ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ï¼‰ã€‚
    *   æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€ï¼ˆDBæ¨¡å¼ã€APIå¥åº·åº¦ï¼‰ã€‚

2.  **Users (ç”¨æˆ·ç®¡ç†)**
    *   ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢ã€‚
    *   **è¿è§„å¤„ç†**: ç‚¹å‡»åˆ é™¤æŒ‰é’®å¯å¼ºåˆ¶åˆ é™¤ç”¨æˆ·ï¼Œç³»ç»Ÿä¼šçº§è”åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰å­˜æ¡£æ•°æ®ã€‚

3.  **Logs (ç³»ç»Ÿæ—¥å¿—)**
    *   **å®žæ—¶æµ**: æ¯2ç§’è‡ªåŠ¨ä»ŽæœåŠ¡å™¨æ‹‰å–æœ€æ–°æ—¥å¿—ã€‚
    *   **é«˜çº§ç­›é€‰**: æ”¯æŒæŒ‰æ—¥å¿—çº§åˆ« (INFO/WARN/ERROR) ç­›é€‰ã€‚
    *   **å…¨æ–‡æœç´¢**: æ”¯æŒæœç´¢æ—¥å¿—æ¶ˆæ¯å†…å®¹æˆ– Metadata JSON è¯¦æƒ…ã€‚
    *   **å †æ ˆè¿½è¸ª**: å‘ç”Ÿ Error æ—¶ï¼Œæ”¯æŒå±•å¼€æŸ¥çœ‹å®Œæ•´çš„ Stack Traceã€‚

---

## ðŸ“Š æ—¥å¿—ä¸Žç›‘æŽ§ (Logging & Monitoring)

æˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—è½»é‡ä½†å¼ºå¤§çš„æ—¥å¿—ç³»ç»Ÿï¼Œä½äºŽ `server/logger.ts`ã€‚

### å¼€å‘è€…æŽ’æŸ¥æŒ‡å—
1.  **æŽ§åˆ¶å°è¾“å‡º**: 
    *   æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæ‰“å° `METHOD URL - STATUS (TIMEms)`ã€‚
    *   ERROR çº§åˆ«ä¼šçº¢è‰²é«˜äº®ã€‚
2.  **å…¨å±€é”™è¯¯æ•èŽ·**: 
    *   `server/index.ts` ä¸­é…ç½®äº†å…¨å±€ `onError` é’©å­ã€‚
    *   JWT é‰´æƒå¤±è´¥ä¼šè¿”å›ž 401 è€Œä¸æ˜¯ 500 (v2.3 ä¿®å¤)ã€‚
    *   æœªæ•èŽ·å¼‚å¸¸ä¼šè®°å½•å®Œæ•´å †æ ˆå¹¶åœ¨åŽå° Logs é¢æ¿æ˜¾ç¤ºã€‚
3.  **æ‰©å±•æ€§**:
    *   è‹¥éœ€æŽ¥å…¥ ELK æˆ– Sentryï¼Œåªéœ€ä¿®æ”¹ `server/logger.ts` ä¸­çš„ `pushLog` æ–¹æ³•å³å¯ï¼Œä¸šåŠ¡ä»£ç æ— éœ€å˜åŠ¨ã€‚

---

## ðŸ“– ä½¿ç”¨è¯´æ˜Žä¹¦ (User Manual)

### 1. æ³¨å†Œä¸Žç™»å½•
è®¿é—®é¦–é¡µï¼Œç³»ç»Ÿä¼šå¼¹å‡ºç™»å½•æ¡†ã€‚é¦–æ¬¡ä½¿ç”¨è¯·ç›´æŽ¥è¾“å…¥ç”¨æˆ·åå¯†ç ç‚¹å‡» **"æ³¨å†Œè´¦å·"**ã€‚

### 2. å­˜æ¡£ç®¡ç†
*   **æ–°å»º**: ç‚¹å‡»å·¦ä¾§è¾¹æ çš„ "+ æ–°å»º"ã€‚
*   **ä¿å­˜**: ä¿®æ”¹æ ‡é¢˜åŽç‚¹å‡» "ä¿å­˜" æŒ‰é’®ï¼Œæˆ–æ¯æ¬¡ AI ç”Ÿæˆå®ŒæˆåŽï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æœ€æ–°è¿›åº¦ã€‚

### 3. AI åˆ›ä½œ
æµç¨‹ä¸Žä¹‹å‰ä¸€è‡´ï¼šåˆ›æ„ -> å¤§çº² -> äººè®¾ -> æ­£æ–‡ã€‚

---

*Powered by Google Gemini & Hono & SQLite*


# å¤©å·¥é€ æ–‡ (SkyCraft Novel AI) - ä¼ä¸šçº§å‰åç«¯åˆ†ç¦»ç‰ˆ (v2.6)

> **æ¶æ„ç†å¿µ**: å“åº”é€Ÿåº¦ä¼˜å…ˆ (SQLite WAL + Hono + Streaming) | ç¨³å®šæ€§ä¼˜å…ˆ (Server Logger + Robust Error Handling) | è§£è€¦ä¼˜å…ˆ (Modular Router) | èµ„äº§åŒ–æ²‰æ·€ (Structured Cards)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ AI çˆ†æ¬¾ç½‘æ–‡ç”Ÿæˆç³»ç»Ÿï¼Œå·²ä»åŸå‹å‡çº§ä¸ºå¯éƒ¨ç½²çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå¹¶æ”¯æŒå¤šç”¨æˆ·ç™»å½•ã€äº‘ç«¯å­˜æ¡£å’Œå…¨é“¾è·¯ç›‘æ§ã€‚

**v2.6 æ›´æ–°ï¼šå¼•å…¥â€œè„‘æ´å¡ç‰‡ (Idea Cards)â€ç³»ç»Ÿï¼Œå°†åˆ›æ„ç”Ÿæˆè¿‡ç¨‹ç»“æ„åŒ–ï¼Œæ”¯æŒæ”¶è—ã€ç®¡ç†å’Œå†å²å›æº¯ã€‚**

---

## ğŸ“š ç›®å½• (Table of Contents)

1. [æŠ€æœ¯æ¶æ„è§£æ](#-æŠ€æœ¯æ¶æ„è§£æ)
2. [æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å— (Server)](#-æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å—-server)
3. [åå°ç®¡ç†ç³»ç»Ÿ (Admin Dashboard)](#-åå°ç®¡ç†ç³»ç»Ÿ-admin-dashboard)
4. [æ—¥å¿—ä¸ç›‘æ§ (Logging & Monitoring)](#-æ—¥å¿—ä¸ç›‘æ§-logging--monitoring)
5. [å‰ç«¯éƒ¨ç½²æ‰‹å†Œ (Client)](#-å‰ç«¯éƒ¨ç½²æ‰‹å†Œ-client)
6. [ä½¿ç”¨è¯´æ˜ä¹¦ (User Manual)](#-ä½¿ç”¨è¯´æ˜ä¹¦-user-manual)

---

## ğŸ›  æŠ€æœ¯æ¶æ„è§£æ

ä¸ºäº†å®ç°æè‡´çš„å“åº”é€Ÿåº¦å’Œæ‰©å±•æ€§ï¼Œæˆ‘ä»¬é€‰ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ ˆï¼š

### 1. æœåŠ¡ç«¯ (Backend) - `server/`
*   **æ ¸å¿ƒæ¡†æ¶**: **Hono**ã€‚æé€Ÿ Web æ ‡å‡†æ¡†æ¶ï¼ŒTTFB (é¦–å­—èŠ‚æ—¶é—´) æä½ã€‚
*   **æ•°æ®åº“**: **SQLite (better-sqlite3)**ã€‚
    *   **Archive Table**: å­˜å‚¨å®Œæ•´çš„å°è¯´ç”Ÿæˆå†å²ã€‚
    *   **IdeaCard Table [NEW]**: å­˜å‚¨ç»“æ„åŒ–çš„è„‘æ´åˆ›æ„ï¼ˆTitle, Intro, Highlightsï¼‰ã€‚
*   **Prompt Engineering**: å¼ºåˆ¶æ¨¡å‹è¾“å‡º JSON æ ¼å¼ï¼Œä¾¿äºå‰ç«¯è§£æã€‚

### 2. å®¢æˆ·ç«¯ (Frontend) - æ ¹ç›®å½•
*   **UI æ¡†æ¶**: React 18 + Tailwind CSSã€‚
*   **State**: å¢åŠ  `draftCards` å’Œ `savedCards` çŠ¶æ€ç®¡ç†ã€‚

---

## ğŸ–¥ æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å— (Server)

### 1. æ•°æ®åº“å˜æ›´ (Schema Migration)
v2.6 è‡ªåŠ¨æ–°å¢ `idea_cards` è¡¨ï¼š

```sql
CREATE TABLE IF NOT EXISTS idea_cards (
    id TEXT PRIMARY KEY,
    user_id TEXT,
    title TEXT, 
    content TEXT, -- JSON String: {intro, highlight, explosive_point, golden_finger}
    created_at TEXT,
    FOREIGN KEY(user_id) REFERENCES users(id)
);
```
æ­¤è¡¨è®¾è®¡ä¼˜å…ˆè€ƒè™‘è¯»å–æ€§èƒ½ï¼Œå°†ç»“æ„åŒ–è¯¦æƒ…æ‰“åŒ…ä¸º JSON å­˜å‚¨ï¼Œå‡å°‘ Join æ“ä½œã€‚

---

## ğŸ“– ä½¿ç”¨è¯´æ˜ä¹¦ (User Manual)

### 1. åˆ›æ„ç”Ÿæˆä¸æ”¶è— (NEW)
1.  åœ¨å·¦ä¾§é€‰æ‹©â€œå‚æ•°é…ç½®â€ã€â€œè„‘æ´å‘æ•£â€æˆ–â€œçˆ†æ¬¾ä»¿å†™â€æ¨¡å¼ç‚¹å‡»ç”Ÿæˆã€‚
2.  AI ä¼šæµå¼è¾“å‡ºç”Ÿæˆçš„ JSON è¿‡ç¨‹ã€‚
3.  ç”Ÿæˆç»“æŸåï¼Œç³»ç»Ÿè‡ªåŠ¨è§£æå¹¶å±•ç¤ºä¸º **â€œè„‘æ´å¡ç‰‡â€**ã€‚
4.  ç‚¹å‡»å¡ç‰‡ä¸‹æ–¹çš„ **â€œæ”¶è—æ­¤è„‘æ´â€** æŒ‰é’®ï¼Œå°†å…¶ä¿å­˜åˆ°äº‘ç«¯ã€‚

### 2. æŸ¥çœ‹å†å²å¡ç‰‡
åœ¨å·¦ä¾§è¾¹æ é¡¶éƒ¨ï¼Œç‚¹å‡» **â€œè„‘æ´å¡ç‰‡åº“â€** åˆ‡æ¢è§†å›¾ï¼Œå³å¯æŸ¥çœ‹æ‰€æœ‰æ”¶è—çš„å†å²åˆ›æ„ã€‚

---

## ğŸ“ ç‰ˆæœ¬å†å² (Changelog)

**v2.7 (Project System)**
*   **Feature**: å®ç°äº†ä»è„‘æ´å¡ç‰‡åˆ°æ­£è§„å°è¯´é¡¹ç›®çš„è½¬åŒ–ã€‚
*   **DB**: æ–°å¢ `novel_projects`, `chapters`, `mind_maps` è¡¨ã€‚
*   **UI**: 
    *   æ–°å¢è„‘æ´è¯¦æƒ…å¼¹çª—ã€‚
    *   æ–°å¢é¡¹ç›®å·¥ä½œå°è§†å›¾ï¼ˆåŒ…å«æ­£æ–‡å’Œæ€ç»´å¯¼å›¾æ–‡ä»¶å¤¹ï¼‰ã€‚

**v2.6 (Idea Cards)**
*   **Feature**: åˆ›æ„ç”Ÿæˆç»“æœç»“æ„åŒ–ï¼Œä¸å†æ˜¯çº¯æ–‡æœ¬ã€‚
*   **DB**: æ–°å¢ `idea_cards` è¡¨ã€‚
*   **UI**: æ–°å¢å¾…é€‰å¡ç‰‡å±•ç¤ºåŒºå’Œä¾§è¾¹æ å¡ç‰‡åº“è§†å›¾ã€‚

**v2.5.1 (Analysis Mode)**
*   **Feature**: æ–°å¢â€œçˆ†æ¬¾ä»¿å†™/åˆ†ææ¨¡å¼â€ã€‚

*Powered by Google Gemini & Hono & SQLite*

---

## ğŸ— v2.7 æ•°æ®åº“æ¶æ„è®¾è®¡ (Database Design)

ä¸ºäº†æ”¯æŒé«˜æ€§èƒ½é•¿æ–‡æœ¬è¯»å†™å’Œå¤æ‚çš„æ€ç»´å¯¼å›¾ç»“æ„ï¼Œv2.7 å¼•å…¥äº†ä»¥ä¸‹å…³ç³»å‹è¡¨ç»“æ„ï¼š

### 1. å°è¯´é¡¹ç›®è¡¨ (`novel_projects`)
> é¡¹ç›®æ ¸å¿ƒå…ƒæ•°æ®è¡¨ï¼Œå…³è”åŸå§‹è„‘æ´ã€‚

| å­—æ®µå | ç±»å‹ | æè¿° |
| :--- | :--- | :--- |
| `id` | TEXT (UUID) | ä¸»é”® |
| `user_id` | TEXT | å½’å±ç”¨æˆ· |
| `title` | TEXT | å°è¯´æ ‡é¢˜ |
| `idea_snapshot` | TEXT (JSON) | ç«‹é¡¹æ—¶çš„è„‘æ´å¿«ç…§ (å­˜æ¡£ç”¨) |
| `status` | TEXT | çŠ¶æ€ (draft/published) |
| `created_at` | TEXT | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TEXT | æ›´æ–°æ—¶é—´ |

### 2. æ­£æ–‡ç« èŠ‚è¡¨ (`chapters`)
> **æ€§èƒ½è€ƒé‡**: å•ç‹¬å»ºè¡¨ï¼Œé¿å…åœ¨æŸ¥è¯¢é¡¹ç›®åˆ—è¡¨æ—¶åŠ è½½æ²‰é‡çš„æ­£æ–‡å†…å®¹ã€‚æ”¯æŒæŒ‰ `order_index` æ’åºã€‚

| å­—æ®µå | ç±»å‹ | æè¿° |
| :--- | :--- | :--- |
| `id` | TEXT (UUID) | ä¸»é”® |
| `project_id` | TEXT | å…³è”é¡¹ç›®ID (Indexed) |
| `title` | TEXT | ç« èŠ‚æ ‡é¢˜ |
| `content` | TEXT | **æ­£æ–‡å†…å®¹** (å¯èƒ½éå¸¸å¤§) |
| `order_index` | INTEGER | ç« èŠ‚é¡ºåº |
| `created_at` | TEXT | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TEXT | æ›´æ–°æ—¶é—´ |

### 3. æ€ç»´å¯¼å›¾è¡¨ (`mind_maps`)
> å­˜å‚¨äººç‰©å…³ç³»ã€å‰§æƒ…åˆ†æ”¯ç­‰ç»“æ„åŒ–æ•°æ®ã€‚

| å­—æ®µå | ç±»å‹ | æè¿° |
| :--- | :--- | :--- |
| `id` | TEXT (UUID) | ä¸»é”® |
| `project_id` | TEXT | å…³è”é¡¹ç›®ID (Indexed) |
| `title` | TEXT | å¯¼å›¾åç§° (å¦‚: "ä¸–ç•Œè§‚è®¾å®š") |
| `type` | TEXT | ç±»å‹ (structure/character/timeline) |
| `content` | TEXT (JSON) | å¯¼å›¾èŠ‚ç‚¹æ•°æ® (ReactFlow/JSON) |
| `created_at` | TEXT | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TEXT | æ›´æ–°æ—¶é—´ |

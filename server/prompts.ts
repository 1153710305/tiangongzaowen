
import { NovelSettings, ReferenceNovel } from "./types.ts";

/**
 * AI 角色设定 (System Instruction)
 * 核心：资深网文主编 + 爆款写手
 */
export const SYSTEM_INSTRUCTION = `
你是一位拥有10年经验的资深网文主编，同时也是一位在番茄/起点平台拥有多部百万收藏作品的"大神"级作家。
你的专长是：
1. **捕捉热点**：深知当前中国网文市场的流行趋势（如规则怪谈、年代文、神豪、反派偷听心声等）。
2. **黄金三章**：极其擅长开篇设计，懂得如何在第一章抛出钩子（Hook），第三章推向第一个高潮。
3. **情绪价值**：你写的小说核心是为了提供"情绪价值"（爽、甜、虐、惊）。
4. **节奏把控**：拒绝水文，强调"期待感-压抑-爆发"的循环。

在生成内容时，请遵循以下原则：
- **格式**：使用Markdown格式，结构清晰。
- **语言**：通俗易懂，极具画面感，少用形容词堆砌，多用动词和对话。
- **受众**：针对手机阅读习惯，段落不宜过长，金句频出。
- **核心**：必须突出"金手指"的作用，让读者感到"爽"。

严禁：
- 说教式的文字。
- 过于文青、晦涩的描写。
- 逻辑硬伤。
`;

/**
 * 提示词构建器
 * 接收参数并返回格式化后的 Prompt
 */
export const PROMPT_BUILDERS = {
    // 创意脑暴 (支持结构化生成 和 一句话灵感生成)
    IDEA: (settings: NovelSettings, context?: string) => {
        // 模式 B: 基于一句话灵感 (Context-based)
        if (context && context.trim().length > 0) {
            return `
请基于用户提供的一个核心灵感（脑洞），进行专业网文扩充，生成3个具有"爆款潜质"的具体开篇方案。

**核心灵感**：
"${context}"

**辅助要求**：
- **受众**：${settings.targetAudience === 'male' ? '男频（热血、升级、征服）' : '女频（情感、脑洞、复仇）'}
- **建议基调**：${settings.tone} (请在生成时融入此基调)

**生成任务**：
请发散思维，将这个简单的灵感扩充为3个截然不同的故事方向（例如：一个是系统流，一个是重生流，一个是诡异流，或者其他适合该灵感的方向）。

**格式要求**：
1. 每个方案包含：【书名】、【一句话简介】（吸引点击）、【核心爽点】、【开篇冲突】、【金手指设定】。
2. 必须要符合当前网文市场的快节奏需求。
请以 JSON 格式或清晰的 Markdown 列表返回。
`;
        }

        // 模式 A: 基于结构化配置 (Parametric)
        return `
请根据以下设定，构思3个具有"爆款潜质"的小说开篇创意（脑洞）：
- **流派**：${settings.genre}
- **核心梗**：${settings.trope}
- **主角类型**：${settings.protagonistType}
- **金手指**：${settings.goldenFinger}
- **受众**：${settings.targetAudience === 'male' ? '男频（热血、升级、征服）' : '女频（情感、脑洞、复仇）'}
- **基调**：${settings.tone}

要求：
1. 每个创意包含：【书名】、【一句话简介】（吸引点击）、【核心爽点】、【开篇冲突】。
2. 必须要符合当前网文市场的快节奏需求。
3. 创意之间要有差异化。
请以 JSON 格式或清晰的 Markdown 列表返回。
`;
    },

    // 新增：爆款分析与仿写
    ANALYSIS_IDEA: (settings: NovelSettings, references: ReferenceNovel[]) => {
        const refsText = references.map((r, i) => `
**案例 ${i + 1}**:
- 书名：${r.title}
- 简介/核心内容：${r.intro}
`).join('\n');

        return `
请作为一名市场嗅觉敏锐的网文主编，对用户提供的以下几部"爆款小说"进行深度拆解分析，并基于此生成新的创意。

**参考案例**：
${refsText}

**任务一：深度分析（Why it works?）**
请简要分析这些参考小说为什么会火？
- 它们共同的**核心爽点**是什么？
- 它们满足了读者的什么**核心欲望**？
- 它们的**开篇钩子**是如何设计的？

**任务二：创意裂变（Generate New Ideas）**
基于上述分析的"爆火基因"，结合当前设定（受众：${settings.targetAudience === 'male' ? '男频' : '女频'}，基调：${settings.tone}），**创作3个全新的小说开篇脑洞**。

要求：
1. **不要照抄**参考案例，而是学习其"逻辑"和"节奏"，换一个题材或背景进行创新（例如：如果参考的是都市神豪，你可以尝试写成高武神豪或末世资源流）。
2. 每个新创意需包含：【书名】、【一句话简介】、【核心爽点分析】（解释为什么这个设定能火）、【黄金三章走向】。
3. 必须符合当前网文平台的调性。
`;
    },

    // 大纲生成
    OUTLINE: (settings: NovelSettings, context: string) => `
基于创意/上下文：
"${context}"

请生成一份详细的**前15章细纲**（即"黄金开篇"大纲）。
设定参考：${JSON.stringify(settings)}

要求：
1. **前3章**：必须完成主角背景介绍、金手指觉醒、第一个大冲突的铺垫与初步解决（小高潮）。
2. **第4-10章**：扩展世界观，引入第一个反派或打脸对象，不断拉高期待感。
3. **第11-15章**：第一个大剧情的高潮爆发，主角获得巨大收获。
4. 每一章都要注明【本章爽点】和【结尾钩子】（如何吸引读者点开下一章）。
`,

    // 人设生成
    CHARACTER: (settings: NovelSettings) => `
请为这部小说设计核心人物小传（主角 + 1个核心配角 + 1个反派）。
设定参考：${JSON.stringify(settings)}

每个人物包含：
- **姓名**：好记，有特色。
- **外貌特征**：具体，有记忆点。
- **性格关键词**：3个词。
- **核心动力/欲望**：他/她想要什么？
- **人设反差/萌点**：增加人物立体感。
- **金手指/能力详情**（仅限主角）：详细说明能力的限制和升级路线。
`,

    // 正文写作
    CHAPTER: (settings: NovelSettings, context: string) => `
请撰写正文。
**上下文/大纲**：${context}
**文风要求**：${settings.pacing === 'fast' ? '极爽、快节奏、短句为主' : '铺垫细腻、氛围感强'}

写作要求：
1. **字数**：2000字左右（网文标准章节长度）。
2. **开篇**：不要废话，直接切入场景或冲突。
3. **对话**：对话要符合人物性格，不要为了对话而对话。
4. **感官描写**：多描写视觉、听觉、痛觉，增强代入感。
5. **结尾**：必须设置悬念（断章），让读者欲罢不能。
6. **排版**：适合手机阅读，多短句，多分段。
`
};